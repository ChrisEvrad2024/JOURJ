import{r as i,h as ae,_ as v,u as me,j as e,$ as P,B as u,V as oe,S as ue,L as xe,C as he,J as U}from"./index-D2Ipw2YP.js";import{C as _,a as pe,b as je,d as ge,c as J}from"./card-CcKSh10K.js";import{T as fe,a as Ne,b as y,c as ve}from"./tabs-BkT1Db25.js";import{S as C}from"./separator-B4UgFw64.js";import{D as Q,a as G,b as K,c as W,d as Y,e as Z}from"./dialog-Bh1R_dux.js";import{T as ye}from"./textarea-BXYulBZ9.js";import{C as A}from"./clock-CXcy2a79.js";import{P as ee}from"./package-B8qsCAxR.js";import{T as te}from"./truck-B32u1BTN.js";import{R as be}from"./refresh-cw-DCuin_Kt.js";import{C as se}from"./circle-alert-cp0tzuw5.js";import"./index-BycQlkId.js";const we=()=>{const[c,h]=i.useState([]),[p,g]=i.useState(!0),[a,o]=i.useState(null),{currentUser:d}=ae();return i.useEffect(()=>{if(!d){h([]),g(!1);return}(async()=>{try{g(!0),o(null);const t=d.role==="admin"?await v.getAllOrders():await v.getUserOrders(d.id);h(t)}catch(t){console.error("Erreur lors du chargement des commandes:",t),o(t.message||"Erreur lors du chargement des commandes")}finally{g(!1)}})()},[d]),{orders:c,loading:p,error:a,cancelOrder:async r=>{try{const t="Annulée à la demande du client";return await v.cancelOrder(r,t),h(c.map(l=>l.id===r?{...l,status:"cancelled",statusHistory:[...l.statusHistory||[],{status:"cancelled",date:new Date().toISOString(),notes:`Annulé par client: ${t}`}]}:l)),!0}catch(t){return console.error(`Erreur lors de l'annulation de la commande ${r}:`,t),o(t.message||"Erreur lors de l'annulation de la commande"),!1}},getOrderById:r=>c.find(t=>t.id===r)||null,getOrdersByStatus:r=>!r||r==="all"?c:c.filter(t=>t.status===r),updateOrderStatus:async(r,t,l="")=>{if(!d||d.role!=="admin")return o("Permission refusée"),!1;try{return await v.updateOrderStatus(r,t,l),h(c.map(n=>n.id===r?{...n,status:t,statusHistory:[...n.statusHistory||[],{status:t,date:new Date().toISOString(),notes:l}]}:n)),!0}catch(n){return console.error(`Erreur lors de la mise à jour du statut de la commande ${r}:`,n),o(n.message||"Erreur lors de la mise à jour du statut de la commande"),!1}}}},x={pending:{label:"En attente",color:"bg-yellow-100 text-yellow-800",icon:e.jsx(A,{className:"h-4 w-4"})},processing:{label:"En cours de traitement",color:"bg-blue-100 text-blue-800",icon:e.jsx(be,{className:"h-4 w-4"})},shipped:{label:"Expédiée",color:"bg-purple-100 text-purple-800",icon:e.jsx(te,{className:"h-4 w-4"})},delivered:{label:"Livrée",color:"bg-green-100 text-green-800",icon:e.jsx(he,{className:"h-4 w-4"})},cancelled:{label:"Annulée",color:"bg-red-100 text-red-800",icon:e.jsx(se,{className:"h-4 w-4"})},refunded:{label:"Remboursée",color:"bg-orange-100 text-orange-800",icon:e.jsx(se,{className:"h-4 w-4"})}},Re=()=>{var F,E,H,B,L,R,$;const[c]=me(),h=c.get("highlight"),[p,g]=i.useState("all"),[a,o]=i.useState(null),[d,f]=i.useState(!1),[b,w]=i.useState(""),[O,r]=i.useState(!1),[t,l]=i.useState(null);ae();const{orders:n,loading:re,error:S,cancelOrder:ne}=we(),k=p==="all"?n:n.filter(s=>s.status===p),D=s=>new Date(s).toLocaleDateString("fr-FR",{year:"numeric",month:"long",day:"numeric"}),le=s=>{o(s),f(!0)},T=s=>{l(s),w(""),r(!0)},ie=async()=>{if(t)try{await ne(t.id,b),r(!1),l(null),U.success("Commande annulée",{description:"Votre commande a été annulée avec succès."})}catch(s){console.error("Failed to cancel order:",s),U.error("Erreur d'annulation",{description:"Une erreur est survenue lors de l'annulation de la commande."})}};return re?e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-serif",children:"Mes commandes"}),e.jsx("p",{className:"text-muted-foreground",children:"Chargement de vos commandes..."})]}),e.jsx("div",{className:"animate-pulse space-y-4",children:[1,2,3].map(s=>e.jsx("div",{className:"h-40 bg-muted rounded-lg"},s))})]}):S?e.jsx("div",{className:"space-y-6",children:e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-serif",children:"Mes commandes"}),e.jsx("p",{className:"text-red-500",children:"Une erreur est survenue lors du chargement de vos commandes."}),e.jsx("p",{className:"text-muted-foreground mt-2",children:S})]})}):e.jsxs("div",{className:"space-y-8",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-serif",children:"Mes commandes"}),e.jsx("p",{className:"text-muted-foreground",children:"Consultez et suivez l'historique de vos commandes."})]}),e.jsxs(fe,{defaultValue:"all",value:p,onValueChange:g,children:[e.jsxs(Ne,{className:"mb-6",children:[e.jsxs(y,{value:"all",children:["Toutes (",n.length,")"]}),e.jsxs(y,{value:"processing",children:["En cours (",n.filter(s=>s.status==="processing").length,")"]}),e.jsxs(y,{value:"delivered",children:["Livrées (",n.filter(s=>s.status==="delivered").length,")"]}),e.jsxs(y,{value:"cancelled",children:["Annulées (",n.filter(s=>s.status==="cancelled").length,")"]})]}),e.jsx(ve,{value:p,className:"space-y-4",children:k.length>0?k.map(s=>{var j,N,z,V,X,q,M;return e.jsxs(_,{className:`overflow-hidden transition-all ${h===s.id?"ring-2 ring-primary":""}`,children:[e.jsx(pe,{className:"bg-muted/50 py-4",children:e.jsxs("div",{className:"flex flex-col md:flex-row md:items-center md:justify-between",children:[e.jsxs("div",{children:[e.jsxs(je,{className:"text-base",children:["Commande #",s.orderNumber||s.id]}),e.jsxs(ge,{children:[D(s.createdAt)," • ",((j=s.items)==null?void 0:j.length)||0," article",(((N=s.items)==null?void 0:N.length)||0)>1?"s":""]})]}),e.jsx("div",{className:"flex items-center space-x-2 mt-2 md:mt-0",children:e.jsxs(P,{variant:"outline",className:`${((z=x[s.status])==null?void 0:z.color)||"bg-gray-100 text-gray-800"} flex gap-1 items-center`,children:[((V=x[s.status])==null?void 0:V.icon)||e.jsx(A,{className:"h-4 w-4"}),((X=x[s.status])==null?void 0:X.label)||s.status]})})]})}),e.jsxs(J,{className:"p-4 md:p-6",children:[e.jsxs("div",{className:"space-y-4",children:[(s.items||[]).slice(0,3).map((m,ce)=>{var I;return e.jsxs("div",{className:"flex items-start space-x-4",children:[e.jsx("div",{className:"w-16 h-16 rounded-md overflow-hidden flex-shrink-0 bg-gray-100",children:m.productImage?e.jsx("img",{src:m.productImage,alt:m.name||m.productName,className:"w-full h-full object-cover",onError:de=>{de.target.src="/placeholder.svg"}}):e.jsx("div",{className:"w-full h-full flex items-center justify-center",children:e.jsx(ee,{className:"text-gray-400"})})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("p",{className:"font-medium truncate",children:m.name||m.productName}),e.jsxs("p",{className:"text-sm text-muted-foreground",children:["Quantité: ",m.quantity]})]}),e.jsx("div",{className:"text-right",children:e.jsxs("p",{className:"font-medium",children:[((I=m.price)==null?void 0:I.toFixed(2))||"0.00"," XAF"]})})]},ce)}),(((q=s.items)==null?void 0:q.length)||0)>3&&e.jsxs("div",{className:"text-center text-sm text-muted-foreground pt-2",children:["+ ",s.items.length-3," autre",s.items.length-3>1?"s":""," article",s.items.length-3>1?"s":""]})]}),e.jsx(C,{className:"my-4"}),e.jsxs("div",{className:"flex flex-col md:flex-row md:items-center md:justify-between",children:[e.jsxs("div",{children:[e.jsxs("p",{className:"text-sm font-semibold",children:["Total: ",((M=s.total)==null?void 0:M.toFixed(2))||"0.00"," XAF"]}),s.tracking&&e.jsxs("a",{href:s.tracking.url,target:"_blank",rel:"noopener noreferrer",className:"text-xs text-primary hover:underline inline-flex items-center mt-1",children:[e.jsx(ee,{className:"h-3 w-3 mr-1"}),"Suivre colis ",s.tracking.carrier," (",s.tracking.number,")"]})]}),e.jsxs("div",{className:"flex space-x-2 mt-4 md:mt-0",children:[e.jsxs(u,{variant:"outline",size:"sm",onClick:()=>le(s),children:["Détails",e.jsx(oe,{className:"h-4 w-4 ml-1"})]}),(s.status==="pending"||s.status==="processing")&&e.jsx(u,{variant:"destructive",size:"sm",onClick:()=>T(s),children:"Annuler"})]})]})]})]},s.id)}):e.jsx(_,{children:e.jsxs(J,{className:"flex flex-col items-center justify-center py-12",children:[e.jsx("div",{className:"rounded-full bg-muted w-12 h-12 flex items-center justify-center mb-4",children:e.jsx(ue,{className:"h-6 w-6 text-muted-foreground"})}),e.jsx("h3",{className:"text-lg font-medium",children:"Aucune commande trouvée"}),e.jsx("p",{className:"text-muted-foreground mt-1 text-center",children:"Vous n'avez pas encore de commandes dans cette catégorie."}),e.jsx(u,{asChild:!0,className:"mt-4",children:e.jsx(xe,{to:"/catalog",children:"Commencer vos achats"})})]})})})]}),e.jsx(Q,{open:d,onOpenChange:f,children:e.jsxs(G,{className:"sm:max-w-[600px]",children:[e.jsxs(K,{children:[e.jsx(W,{children:"Détails de la commande"}),e.jsx(Y,{children:a&&`Commande #${a.orderNumber||a.id} • ${D(a==null?void 0:a.createdAt)}`})]}),a&&e.jsxs("div",{className:"space-y-4",children:[e.jsx("div",{className:"flex items-center",children:e.jsxs(P,{variant:"outline",className:`${((F=x[a.status])==null?void 0:F.color)||"bg-gray-100 text-gray-800"} flex gap-1 items-center`,children:[((E=x[a.status])==null?void 0:E.icon)||e.jsx(A,{className:"h-4 w-4"}),((H=x[a.status])==null?void 0:H.label)||a.status]})}),a.statusHistory&&a.statusHistory.length>0&&e.jsxs("div",{className:"space-y-2",children:[e.jsx("h4",{className:"text-sm font-medium",children:"Historique du statut"}),e.jsx("div",{className:"space-y-2",children:a.statusHistory.map((s,j)=>{var N;return e.jsxs("div",{className:"text-sm flex items-start",children:[e.jsx("div",{className:"w-24 flex-shrink-0 text-muted-foreground",children:new Date(s.date).toLocaleDateString()}),e.jsxs("div",{className:"flex-1",children:[e.jsx("span",{className:"font-medium",children:((N=x[s.status])==null?void 0:N.label)||s.status}),s.notes&&e.jsx("p",{className:"text-muted-foreground text-xs mt-0.5",children:s.notes})]})]},j)})})]}),e.jsx(C,{}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("h4",{className:"text-sm font-medium",children:"Articles commandés"}),e.jsx("div",{className:"space-y-2",children:(a.items||[]).map((s,j)=>e.jsxs("div",{className:"flex justify-between text-sm",children:[e.jsxs("div",{className:"flex items-start gap-2",children:[e.jsxs("span",{className:"font-medium",children:[s.quantity,"x"]}),e.jsx("span",{children:s.name||s.productName})]}),e.jsxs("div",{className:"font-medium",children:[(s.price*s.quantity).toFixed(2)||"0.00"," XAF"]})]},j))})]}),e.jsxs("div",{className:"space-y-2 bg-muted p-3 rounded-lg",children:[e.jsxs("div",{className:"flex justify-between text-sm",children:[e.jsx("span",{children:"Sous-total:"}),e.jsxs("span",{children:[((B=a.subtotal)==null?void 0:B.toFixed(2))||"0.00"," XAF"]})]}),e.jsxs("div",{className:"flex justify-between text-sm",children:[e.jsx("span",{children:"Frais de livraison:"}),e.jsxs("span",{children:[((L=a.shippingCost)==null?void 0:L.toFixed(2))||"0.00"," XAF"]})]}),a.taxAmount&&e.jsxs("div",{className:"flex justify-between text-sm",children:[e.jsx("span",{children:"TVA:"}),e.jsxs("span",{children:[((R=a.taxAmount)==null?void 0:R.toFixed(2))||"0.00"," XAF"]})]}),e.jsx(C,{className:"my-1"}),e.jsxs("div",{className:"flex justify-between font-medium",children:[e.jsx("span",{children:"Total:"}),e.jsxs("span",{children:[(($=a.total)==null?void 0:$.toFixed(2))||"0.00"," XAF"]})]})]}),a.shippingAddress&&e.jsxs("div",{className:"space-y-2",children:[e.jsx("h4",{className:"text-sm font-medium",children:"Adresse de livraison"}),e.jsxs("div",{className:"text-sm",children:[e.jsxs("p",{className:"font-medium",children:[a.shippingAddress.firstName," ",a.shippingAddress.lastName]}),e.jsx("p",{children:a.shippingAddress.address1}),a.shippingAddress.address2&&e.jsx("p",{children:a.shippingAddress.address2}),e.jsxs("p",{children:[a.shippingAddress.postalCode," ",a.shippingAddress.city]}),e.jsx("p",{children:a.shippingAddress.country}),a.shippingAddress.phone&&e.jsxs("p",{children:["Tél: ",a.shippingAddress.phone]})]})]}),a.paymentMethod&&e.jsxs("div",{className:"text-sm",children:[e.jsx("span",{className:"font-medium",children:"Méthode de paiement:"})," ",a.paymentMethod]}),a.tracking&&e.jsxs("div",{className:"space-y-1",children:[e.jsx("h4",{className:"text-sm font-medium",children:"Informations de suivi"}),e.jsxs("div",{className:"text-sm",children:[e.jsxs("p",{children:["Transporteur: ",a.tracking.carrier]}),e.jsxs("p",{children:["Numéro de suivi: ",a.tracking.number]}),a.tracking.url&&e.jsxs("a",{href:a.tracking.url,target:"_blank",rel:"noopener noreferrer",className:"text-primary hover:underline inline-flex items-center mt-1",children:[e.jsx(te,{className:"h-3 w-3 mr-1"}),"Suivre votre colis en ligne"]})]})]}),e.jsxs(Z,{children:[(a.status==="pending"||a.status==="processing")&&e.jsx(u,{variant:"destructive",onClick:()=>{f(!1),T(a)},children:"Annuler la commande"}),e.jsx(u,{onClick:()=>f(!1),children:"Fermer"})]})]})]})}),e.jsx(Q,{open:O,onOpenChange:r,children:e.jsxs(G,{className:"sm:max-w-[500px]",children:[e.jsxs(K,{children:[e.jsx(W,{children:"Annuler la commande"}),e.jsx(Y,{children:"Veuillez indiquer la raison de l'annulation de votre commande."})]}),e.jsxs("div",{className:"space-y-4 py-2",children:[e.jsx(ye,{placeholder:"Raison de l'annulation (facultatif)",value:b,onChange:s=>w(s.target.value),rows:4}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Note: L'annulation d'une commande est définitive. Si vous souhaitez les mêmes produits ultérieurement, vous devrez passer une nouvelle commande."})]}),e.jsxs(Z,{children:[e.jsx(u,{variant:"outline",onClick:()=>r(!1),children:"Annuler"}),e.jsx(u,{variant:"destructive",onClick:ie,children:"Confirmer l'annulation"})]})]})})]})};export{Re as default};
